---
# ONEX Node Contract - Intent Classifier Compute Node
#
# Part of pattern_extraction split (Track 2 Intelligence Hook System)
contract_version:
  major: 1
  minor: 0
  patch: 0
node_version:
  major: 1
  minor: 0
  patch: 0
name: "node_intent_classifier_compute"
node_type: "COMPUTE_GENERIC"
description: >-
  Compute node for classifying user intents from code patterns and execution traces. Maps observed behavior
  to intent categories.
input_model:
  name: "ModelIntentClassificationInput"
  module: "omniintelligence.nodes.node_intent_classifier_compute.models"
  description: "Input containing content and classification parameters."
output_model:
  name: "ModelIntentClassificationOutput"
  module: "omniintelligence.nodes.node_intent_classifier_compute.models"
  description: "Output containing classified intents and confidence scores."
operations:
  - name: "classify_intent"
    description: "Classify intent from content using TF-IDF pattern matching"
    input_fields:
      - content
      - correlation_id
      - context
      - confidence_threshold
      - multi_label
    output_fields:
      - success
      - intent_category
      - confidence
      - secondary_intents
      - keywords
      - processing_time_ms
  - name: "analyze_semantics"
    description: "Perform semantic analysis to extract domains, concepts, and themes from content"
    input_fields:
      - content
      - context
      - min_confidence
    output_fields:
      - concepts
      - themes
      - domains
      - patterns
      - domain_indicators
      - topic_weights
      - processing_time_ms
      - error
  - name: "map_semantic_to_intent_boost"
    description: "Map semantic analysis results to intent confidence boosts"
    input_fields:
      - semantic_result
    output_fields:
      - intent_boosts
# =============================================================================
# Configuration Parameters
# =============================================================================
# These parameters control the behavior of the intent classification and
# semantic analysis algorithms. Values can be overridden at runtime via
# environment variables or config injection.
#
# Naming Convention:
#   - Module constants use SCREAMING_SNAKE_CASE (e.g., EXACT_MATCH_WEIGHT)
#   - Config keys use snake_case (e.g., exact_match_weight)
# =============================================================================
configuration:
  # ---------------------------------------------------------------------------
  # Intent Classification Parameters (handler_intent_classification.py)
  # ---------------------------------------------------------------------------
  classification:
    # Weight applied to exact keyword matches in TF-IDF scoring.
    # Higher values prioritize exact matches over partial matches.
    exact_match_weight: 15.0

    # Weight applied to partial/fuzzy keyword matches.
    # Should be lower than exact_match_weight to prefer exact matches.
    partial_match_weight: 3.0

    # Minimum pattern length required for partial matching.
    # Prevents false positives from very short patterns.
    min_pattern_length_for_partial: 3

    # Default confidence threshold for classification results.
    # Results below this threshold return "unknown" intent.
    default_confidence_threshold: 0.5

    # Maximum number of secondary intents to return in multi-label mode.
    default_max_intents: 5

  # ---------------------------------------------------------------------------
  # Semantic Analysis Parameters (handler_langextract.py)
  # ---------------------------------------------------------------------------
  semantic_analysis:
    # Confidence boost amounts for different match types
    boosts:
      # Boost applied when a domain indicator matches an intent category.
      domain_match_boost: 0.10

      # Boost applied when a concept matches an intent category.
      # Multiplied by concept confidence.
      concept_match_boost: 0.05

      # Multiplier for topic weights when calculating intent boosts.
      topic_weight_multiplier: 0.15

      # Maximum total boost that can be applied to any single intent.
      # Prevents over-boosting from multiple matches.
      max_boost_cap: 0.30

      # Boost applied when context matches a domain.
      context_boost: 0.15

    # Default minimum confidence threshold for semantic results.
    default_min_confidence: 0.3

    # Scoring algorithm parameters for domain detection
    scoring:
      # Initial base score for domain matches.
      # Formula: match_base = min(match_base_max, match_base_initial + (matches * match_base_initial))
      match_base_initial: 0.15

      # Maximum base score from keyword matches.
      match_base_max: 0.6

      # Maximum bonus from high match density.
      density_bonus_max: 0.2

      # Multiplier for match ratio when calculating density bonus.
      density_multiplier: 0.3

      # Maximum bonus from keyword diversity.
      diversity_bonus_max: 0.2

      # Multiplier for unique keyword count when calculating diversity bonus.
      diversity_multiplier: 0.05

      # Multiplier for concept confidence when extracting concepts.
      concept_confidence_multiplier: 0.8

    # Limits for result set sizes
    limits:
      # Maximum number of concepts to return.
      max_concepts: 20

      # Maximum number of domain indicators to return.
      max_domain_indicators: 5

# =============================================================================
# TODO(OMN-1478): Protocol Integration - ProtocolIntentClassifier
# =============================================================================
# Status: Backlog
# Issue: https://linear.app/omninode/issue/OMN-1478
#
# Priority: Low (current implementation functional without protocol abstraction)
# Description: Add ProtocolIntentClassifier to omnibase_spi
#
# When implemented:
#   - Import from omnibase_spi.protocols.intelligence.ProtocolIntentClassifier
#   - Node should implement the protocol interface
#   - Uncomment dependency below
# =============================================================================
dependencies: []
# Future dependency (when OMN-1478 is implemented):
# - name: "intent_classifier"
#   type: "protocol"
#   module: "omnibase_spi.protocols.intelligence"
#   description: "Intent classification protocol from SPI"
# Error Handling Configuration
# ============================
error_handling:
  error_types:
    - name: "IntentClassificationValidationError"
      error_code: "INTENT_001"
      description: "Input validation failed"
      recoverable: false
      retry_strategy: "none"
    - name: "IntentClassificationComputeError"
      error_code: "INTENT_002"
      description: "Error during intent classification"
      recoverable: true
      retry_strategy: "immediate_retry"
    - name: "SemanticAnalysisError"
      error_code: "INTENT_003"
      description: "Error during semantic analysis (returns empty result, non-blocking)"
      recoverable: true
      retry_strategy: "none"
health_check:
  enabled: true
  endpoint: "/health"
  interval_seconds: 30
metadata:
  author: "OmniNode Team"
  created: "2025-10-02"
  updated: "2026-01-23"
  tags:
    - "ONEX"
    - "compute"
    - "intent"
    - "classifier"
    - "pattern-extraction"
    - "semantic-analysis"
