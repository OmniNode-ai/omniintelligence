---
# ONEX Node Contract - Pattern Learning Compute Node
#
# STATUS: ACTIVE - Fully implemented pattern aggregation node
# This node aggregates and summarizes observed patterns following the 4-phase pipeline.
# =============================================================================
contract_version:
  major: 1
  minor: 0
  patch: 0
node_version:
  major: 1
  minor: 0
  patch: 0
name: "node_pattern_learning_compute"
node_type: "COMPUTE_GENERIC"
status: "active"
description: >-
  Compute node for pattern aggregation operations. Orchestrates the 4-phase pipeline: feature extraction,
  clustering, confidence scoring, and deduplication. This node describes STRUCTURE, not IMPORTANCE - all
  thresholds are inputs, not decisions.
input_model:
  name: "ModelPatternLearningInput"
  module: "omniintelligence.nodes.node_pattern_learning_compute.models"
  description: "Input containing training data items and optional learning parameters."
output_model:
  name: "ModelPatternLearningOutput"
  module: "omniintelligence.nodes.node_pattern_learning_compute.models"
  description: >-
    Output containing candidate/learned patterns, metrics, and metadata. Uses contract models from omnibase_core.
# Capability declaration (capability-oriented naming)
capabilities:
  - name: "pattern_learning.aggregate"
    description: "Orchestrate 4-phase pattern aggregation pipeline"
    version: "1.0.0"
  - name: "pattern_learning.feature_extraction"
    description: "Extract AST-based features from training data items"
  - name: "pattern_learning.clustering"
    description: "Cluster similar patterns using single-linkage algorithm"
  - name: "pattern_learning.confidence_scoring"
    description: "Compute decomposed confidence scores for clusters"
  - name: "pattern_learning.deduplication"
    description: "Remove overlapping patterns with versioned signatures"
# Handler routing for pattern learning operations
# Main handler orchestrates 4-phase pipeline: extract -> cluster -> score -> dedupe
handler_routing:
  routing_strategy: "operation_match"
  handlers:
    - operation: "pattern_learning.aggregate"
      handler_class: "HandlerPatternLearning"
      handler_module: "omniintelligence.nodes.node_pattern_learning_compute.handlers.handler_pattern_learning"
      description: "Orchestrates 4-phase pattern aggregation pipeline (feature extraction, clustering,
        confidence scoring, deduplication)"
# Dependencies (handlers and sub-handlers for pipeline phases)
dependencies:
  - name: "handler_pattern_learning"
    type: "handler"
    class_name: "HandlerPatternLearning"
    module: "omniintelligence.nodes.node_pattern_learning_compute.handlers.handler_pattern_learning"
    description: "Main orchestration handler for pattern learning pipeline"
  - name: "handler_feature_extraction"
    type: "handler"
    class_name: "extract_features_batch"
    module: "omniintelligence.nodes.node_pattern_learning_compute.handlers.handler_feature_extraction"
    description: "AST-based feature extraction from training data items"
  - name: "handler_pattern_clustering"
    type: "handler"
    class_name: "cluster_patterns"
    module: "omniintelligence.nodes.node_pattern_learning_compute.handlers.handler_pattern_clustering"
    description: "Single-linkage clustering with 5-component weighted similarity"
  - name: "handler_confidence_scoring"
    type: "handler"
    class_name: "compute_cluster_scores"
    module: "omniintelligence.nodes.node_pattern_learning_compute.handlers.handler_confidence_scoring"
    description: "Decomposed confidence scoring (label_agreement, cohesion, frequency)"
  - name: "handler_deduplication"
    type: "handler"
    class_name: "deduplicate_patterns"
    module: "omniintelligence.nodes.node_pattern_learning_compute.handlers.handler_deduplication"
    description: "Pattern deduplication with versioned signatures and policy transparency"
# Error Handling Configuration
# =============================================
error_handling:
  error_types:
    - name: "PatternLearningValidationError"
      error_code: "PATLEARN_001"
      description: "Input validation failed"
      recoverable: false
      retry_strategy: "none"
    - name: "PatternLearningComputeError"
      error_code: "PATLEARN_002"
      description: "Error during pattern learning computation"
      recoverable: true
      retry_strategy: "immediate_retry"
health_check:
  enabled: false
  endpoint: "/health"
  interval_seconds: 30
metadata:
  author: "OmniNode Team"
  created: "2025-11-14"
  updated: "2026-01-29"
  # NOTE: status field is at root level (line 17), not duplicated here
  tags:
    - "ONEX"
    - "compute"
    - "pattern-learning"
