---
# ONEX Node Contract - PostgreSQL Pattern Effect Node
contract_version:
  major: 1
  minor: 0
  patch: 0
node_version:
  major: 1
  minor: 0
  patch: 0
name: "postgres_pattern_effect"
node_type: "EFFECT_GENERIC"
description: >-
  Effect node for storing and querying patterns in PostgreSQL. Handles pattern persistence, retrieval,
  and analytics queries.
input_model:
  name: "ModelPostgresPatternInput"
  module: "omniintelligence.nodes.postgres_pattern_effect.models"
  description: "Input containing pattern data and operation type."
output_model:
  name: "ModelPostgresPatternOutput"
  module: "omniintelligence.nodes.postgres_pattern_effect.models"
  description: "Output containing operation status and query results."
# TODO: Handler routing - modules not yet implemented
# When implementing, create handlers/ directory with the following modules:
# - handler_postgres_store_pattern.py (HandlerPostgresStorePattern)
# - handler_postgres_query_patterns.py (HandlerPostgresQueryPatterns)
# - handler_postgres_update_score.py (HandlerPostgresUpdateScore)
#
# handler_routing:
#   routing_strategy: "payload_type_match"
#   handlers:
#     - operation: "store_pattern"
#       handler:
#         name: "HandlerPostgresStorePattern"
#         module: "omniintelligence.nodes.postgres_pattern_effect.handlers.handler_postgres_store_pattern"
#       description: "Store pattern in PostgreSQL"
#     - operation: "query_patterns"
#       handler:
#         name: "HandlerPostgresQueryPatterns"
#         module: "omniintelligence.nodes.postgres_pattern_effect.handlers.handler_postgres_query_patterns"
#       description: "Query patterns from database"
#     - operation: "update_pattern_score"
#       handler:
#         name: "HandlerPostgresUpdateScore"
#         module: "omniintelligence.nodes.postgres_pattern_effect.handlers.handler_postgres_update_score"
#       description: "Update pattern scoring"
#   execution_mode: "sequential"
error_handling:
  retry_policy:
    max_retries: 3
    initial_delay_ms: 100
    max_delay_ms: 5000
    exponential_base: 2
    retry_on:
      # Standard Python transient errors
      - "ConnectionError"
      - "TimeoutError"
      - "OSError"
      # asyncpg-specific errors (transient)
      - "asyncpg.exceptions.ConnectionDoesNotExistError"
      - "asyncpg.exceptions.InterfaceError"
      - "asyncpg.exceptions.TooManyConnectionsError"
  circuit_breaker:
    enabled: true
    failure_threshold: 5
    reset_timeout_ms: 60000
dependencies:
  - name: "postgres_adapter"
    type: "protocol"
    module: "asyncpg"
    description: "PostgreSQL adapter for database operations"
health_check:
  enabled: true
  endpoint: "/health"
  interval_seconds: 30
metadata:
  author: "OmniNode Team"
  created: "2025-11-14"
  updated: "2026-01-18"
  tags:
    - "ONEX"
    - "effect"
    - "postgresql"
    - "patterns"
    - "storage"
