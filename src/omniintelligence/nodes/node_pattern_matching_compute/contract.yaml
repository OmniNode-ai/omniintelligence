# SPDX-FileCopyrightText: 2025 OmniNode.ai Inc.
# SPDX-License-Identifier: MIT
---
# ONEX Node Contract - Pattern Matching Compute Node
contract_version:
  major: 1
  minor: 0
  patch: 0
node_version:
  major: 1
  minor: 0
  patch: 0
name: "node_pattern_matching_compute"
node_type: "COMPUTE_GENERIC"
description: >-
  Compute node for matching code patterns against a pattern library. Identifies design patterns, anti-patterns,
  and custom patterns.
input_model:
  name: "ModelPatternMatchingInput"
  module: "omniintelligence.nodes.node_pattern_matching_compute.models"
  description: "Input containing code to match and pattern library reference."
output_model:
  name: "ModelPatternMatchingOutput"
  module: "omniintelligence.nodes.node_pattern_matching_compute.models"
  description: "Output containing matched patterns and confidence scores."
operations:
  - name: "match_patterns"
    description: "Match patterns in code using keyword overlap or regex algorithms"
    input_fields:
      - code_snippet
      - patterns
      - operation
      - project_name
      - context
    output_fields:
      - success
      - patterns_matched
      - pattern_scores
      - matches
      - metadata
# Handler Routing (Declarative Pattern)
# =====================================
# Compute nodes use a single handler that routes based on operation type.
handler_routing:
  routing_strategy: "operation_match"
  handlers:
    - operation: "match"
      handler:
        function: "handle_pattern_matching_compute"
        module: "omniintelligence.nodes.node_pattern_matching_compute.handlers"
        type: "sync"
    - operation: "similarity"
      handler:
        function: "handle_pattern_matching_compute"
        module: "omniintelligence.nodes.node_pattern_matching_compute.handlers"
        type: "sync"
    - operation: "classify"
      handler:
        function: "handle_pattern_matching_compute"
        module: "omniintelligence.nodes.node_pattern_matching_compute.handlers"
        type: "sync"
    - operation: "validate"
      handler:
        function: "handle_pattern_matching_compute"
        module: "omniintelligence.nodes.node_pattern_matching_compute.handlers"
        type: "sync"
# Metadata Model (for typed metadata in output)
# =============================================
# The output model uses ModelPatternMatchingMetadata for type-safe metadata
# instead of dict[str, Any]. This provides structured status, message, and
# tracking information for the matching operation.
metadata_model:
  name: "ModelPatternMatchingMetadata"
  module: "omniintelligence.nodes.node_pattern_matching_compute.models"
  description: "Typed metadata for pattern matching output (status, message, tracking_url, operation,
    etc.)"
# Protocol Dependencies
# =====================
# This is a pure compute node - no protocol dependencies needed.
# Patterns are passed via the input model (ModelPatternRecord[]) following
# the compute node purity principle. The orchestrator fetches patterns from
# storage and passes them to this node.
dependencies: []
# Error Handling Configuration
# ============================
error_handling:
  error_types:
    - name: "PatternMatchingValidationError"
      error_code: "PATMATCH_001"
      description: "Input validation failed"
      recoverable: false
      retry_strategy: "none"
    - name: "PatternMatchingComputeError"
      error_code: "PATMATCH_002"
      description: "Error during pattern matching computation"
      recoverable: true
      retry_strategy: "immediate_retry"
health_check:
  enabled: true
  endpoint: "/health"
  interval_seconds: 30
metadata:
  author: "OmniNode Team"
  created: "2025-11-14"
  updated: "2026-02-05"
  tags:
    - "ONEX"
    - "compute"
    - "patterns"
    - "matching"
    - "keyword_overlap"
    - "regex_match"
