name: processing_subcontract
version:
  major: 1
  minor: 0
  patch: 0

description: |
  Processing operations subcontract for intelligence orchestrator.
  Handles document ingestion, vectorization, entity extraction, and analysis.

operations:
  ingest_document:
    description: Orchestrate document ingestion workflow
    input:
      document_id: str
      file_path: str
      content: str
      metadata: dict
    output:
      ingested: bool
      vectorized: bool
      entities_extracted: int
      relationships_found: int
    workflow: document_ingestion
    compute_nodes:
      - vectorization_compute
      - entity_extraction_compute
      - relationship_detection_compute
    effect_nodes:
      - qdrant_vector_effect
      - memgraph_graph_effect
      - kafka_event_effect

  learn_patterns:
    description: Orchestrate pattern learning workflow across 4 phases
    input:
      code_snippet: str
      project_name: str
      context: dict
    output:
      patterns_matched: list
      pattern_scores: dict
      phase_results: dict
    workflow: pattern_learning
    compute_nodes:
      - pattern_matching_compute
      - semantic_analysis_compute
    effect_nodes:
      - postgres_pattern_effect
      - kafka_event_effect

  assess_quality:
    description: Orchestrate quality assessment workflow
    input:
      file_path: str
      content: str
      language: str
      project_name: str
    output:
      quality_score: float
      dimensions: dict
      onex_compliant: bool
      recommendations: list
    workflow: quality_assessment
    compute_nodes:
      - quality_scoring_compute
    effect_nodes:
      - kafka_event_effect
      - intelligence_api_effect

  analyze_semantics:
    description: Orchestrate semantic analysis workflow
    input:
      code_snippet: str
      context: dict
    output:
      semantic_features: dict
      embeddings: list
      similarity_scores: dict
    workflow: semantic_analysis
    compute_nodes:
      - semantic_analysis_compute
      - vectorization_compute
    effect_nodes:
      - qdrant_vector_effect

  detect_relationships:
    description: Orchestrate relationship detection workflow
    input:
      entities: list
      context: dict
    output:
      relationships: list
      graph_updated: bool
    workflow: relationship_detection
    compute_nodes:
      - relationship_detection_compute
    effect_nodes:
      - memgraph_graph_effect

# Error handling
error_handling:
  retry_policy:
    max_retries: 3
    backoff_strategy: exponential
    initial_delay_ms: 2000

  timeout_policy:
    default_timeout_ms: 300000
    operation_timeouts_ms:
      ingest_document: 600000
      learn_patterns: 900000
      assess_quality: 300000
      analyze_semantics: 300000
      detect_relationships: 300000

  fallback_strategy: publish_to_dlq

# Performance settings
performance:
  enable_parallel_execution: true
  max_concurrent_operations: 5
  enable_result_caching: true
  cache_ttl_ms: 300000
