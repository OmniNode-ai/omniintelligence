name: intelligence_reducer
version:
  major: 1
  minor: 0
  patch: 0

description: |
  Unified reducer for ALL intelligence FSMs.
  Pure reducer with all state stored in PostgreSQL fsm_state table.
  Handles 3 FSM types via enum routing:
  - INGESTION: Document ingestion FSM
  - PATTERN_LEARNING: 4-phase pattern learning FSM
  - QUALITY_ASSESSMENT: Quality scoring FSM

node_type: reducer

input_model: omniintelligence.nodes.intelligence_reducer.v1_0_0.models.ModelReducerInput
output_model: omniintelligence.nodes.intelligence_reducer.v1_0_0.models.ModelReducerOutput

# Dependencies
# NOTE: REDUCER nodes can only depend on EFFECT and COMPUTE nodes per ONEX architecture
# Flow: EFFECT → COMPUTE → REDUCER → ORCHESTRATOR (unidirectional)
dependencies:
  - name: kafka_event_effect
    dependency_type: module
    required: true
    description: Kafka event effect for event publishing

# Performance requirements
performance:
  single_operation_max_ms: 100
  batch_operation_max_ms: 1000
  throughput_ops_per_second: 1000

# State transitions FSM subcontract
state_transitions:
  initial_state: RECEIVED
  states:
    - state_name: RECEIVED
      description: Initial state when document is received
      is_terminal: false
    - state_name: PROCESSING
      description: Document is being processed
      is_terminal: false
    - state_name: INDEXED
      description: Document has been indexed successfully
      is_terminal: true
    - state_name: FAILED
      description: Processing failed
      is_terminal: true
  transitions:
    - from_state: RECEIVED
      to_state: PROCESSING
      trigger: START_PROCESSING
    - from_state: RECEIVED
      to_state: FAILED
      trigger: FAIL
    - from_state: PROCESSING
      to_state: INDEXED
      trigger: COMPLETE_INDEXING
    - from_state: PROCESSING
      to_state: FAILED
      trigger: FAIL
    - from_state: INDEXED
      to_state: PROCESSING
      trigger: REINDEX
    - from_state: FAILED
      to_state: PROCESSING
      trigger: RETRY
  operations:
    - operation_name: transition
      requires_atomic_execution: true
      supports_rollback: true
    - operation_name: snapshot
      requires_atomic_execution: true
      supports_rollback: true
    - operation_name: restore
      requires_atomic_execution: true
      supports_rollback: true

# Event type subcontract for event-driven architecture
event_type:
  version:
    major: 1
    minor: 0
    patch: 0
  primary_events:
    - FSM_STATE_CHANGED
    - FSM_TRANSITION_COMPLETED
    - FSM_TRANSITION_FAILED
  event_categories:
    - fsm
    - state_management
    - intelligence
  event_routing: intelligence_reducer
  publish_events: true
  subscribe_events: false

# Reducer-specific settings
order_preserving: true
incremental_processing: true
result_caching_enabled: true
partial_results_enabled: false

# Metadata
author: omniintelligence
tags:
  - reducer
  - fsm
  - pure
  - intelligence
