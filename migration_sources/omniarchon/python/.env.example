# Archon Environment Configuration
# Copy this file to .env and update values as needed

# ==============================================================================
# Backend Service Ports
# ==============================================================================

# Main Archon server port
ARCHON_SERVER_PORT=8181

# Intelligence service port (quality, performance, patterns)
INTELLIGENCE_SERVICE_PORT=8053

# Bridge service port (metadata, hashing, events)
BRIDGE_SERVICE_PORT=8054

# Search service port (RAG, vector search)
SEARCH_SERVICE_PORT=8055

# Agents service port (AI orchestration)
ARCHON_AGENTS_PORT=8052

# ==============================================================================
# Database Configuration
# ==============================================================================

# Supabase (PostgreSQL)
SUPABASE_URL=https://your-project.supabase.co
SUPABASE_SERVICE_KEY=your-service-key-here

# Memgraph (Knowledge Graph)
MEMGRAPH_URI=bolt://localhost:7687

# Qdrant (Vector Database)
QDRANT_URL=http://localhost:6333

# Valkey/Redis (Distributed Cache)
VALKEY_URL=redis://localhost:6379/0
ENABLE_CACHE=true

# ==============================================================================
# AI/ML Configuration
# ==============================================================================

# OpenAI API
OPENAI_API_KEY=sk-your-openai-api-key-here

# Ollama (Local LLM server)
OLLAMA_BASE_URL=http://localhost:11434

# ==============================================================================
# Security
# ==============================================================================

# Service authentication token for backend services
SERVICE_AUTH_TOKEN=your-secure-service-token-here

# ==============================================================================
# Performance Configuration
# ==============================================================================

# Performance Baseline Service - Maximum measurements to retain in memory per operation
# Default: 1000 (~1-2MB memory per operation)
# Lower values: reduce memory footprint (e.g., 500 for low-memory deployments)
# Higher values: more historical data for trend analysis (e.g., 5000 for production monitoring)
PERFORMANCE_MAX_MEASUREMENTS=1000

# ==============================================================================
# Performance Testing Configuration
# ==============================================================================
# These settings are used for pytest performance benchmarks

# Cold Cache Performance (First query, no cached results)
# Target: <7-9s baseline
COLD_CACHE_TIMEOUT_MS=9000

# Warm Cache Performance (Repeated query with cache hits)
# Target: <100ms ideal, <1000ms acceptable
WARM_CACHE_TIMEOUT_MS=1000

# Parallel Query Performance (Multiple concurrent queries)
# Target: <5000ms with shared cache efficiency
PARALLEL_QUERY_TIMEOUT_MS=5000

# Retry Logic Performance (Service failures with exponential backoff)
# Includes: 3 retries with 1s → 2s → 4s delays
RETRY_TIMEOUT_MS=15000

# Connection Pool Performance (HTTP/2 connection reuse)
CONNECTION_POOL_TIMEOUT_MS=5000

# Full Benchmark Timeout (Comprehensive performance suite)
FULL_BENCHMARK_TIMEOUT_MS=30000

# Cache Operation Timeouts
CACHE_GET_TIMEOUT_MS=1000
CACHE_SET_TIMEOUT_MS=1000
CACHE_CLEAR_TIMEOUT_MS=5000

# Edge Case Test Timeouts
LARGE_RESULT_TIMEOUT_MS=10000
CONCURRENT_WRITE_TIMEOUT_MS=5000
CACHE_EVICTION_TIMEOUT_MS=10000
NETWORK_PARTITION_TIMEOUT_MS=5000

# Test Database Configuration
VALKEY_TEST_DB=15
VALKEY_TEST_URL=redis://localhost:6379/15

# Test Retry Configuration
PYTEST_FLAKY_RERUNS=2
PYTEST_FLAKY_DELAY=1

# Performance Benchmark Configuration
BENCHMARK_SAVE_REPORT=true
BENCHMARK_REPORT_DIR=reports/performance

# ==============================================================================
# Alerting & Notifications
# ==============================================================================

# Slack Webhook for service health alerts
# Create webhook: https://api.slack.com/messaging/webhooks
# Format: https://hooks.slack.com/services/T00000000/B00000000/XXXXXXXXXXXXXXXXXXXX
SLACK_WEBHOOK_URL=

# Email Alerts (optional)
ALERT_EMAIL_SMTP_SERVER=smtp.gmail.com
ALERT_EMAIL_SMTP_PORT=587
ALERT_EMAIL_FROM=alerts@archon.dev
ALERT_EMAIL_TO=ops-team@archon.dev
ALERT_EMAIL_USERNAME=
ALERT_EMAIL_PASSWORD=

# Alert Configuration
ENABLE_SLACK_ALERTS=true
ENABLE_EMAIL_ALERTS=false
ALERT_CHECK_INTERVAL_SECONDS=60  # Check container health every 60 seconds
ALERT_COOLDOWN_SECONDS=300  # 5 minutes cooldown between duplicate health alerts

# Error Log Monitoring
ENABLE_ERROR_MONITORING=true  # Monitor container logs for errors
ERROR_LOG_WINDOW_SECONDS=300  # Check logs from last 5 minutes
ERROR_COOLDOWN_SECONDS=900  # 15 minutes cooldown between duplicate error alerts

# Log Sanitization (Security)
# Automatically removes sensitive data from logs before sending to external services
ENABLE_LOG_SANITIZATION=true  # Enable log sanitization (RECOMMENDED: always true in production)
SANITIZE_IP_ADDRESSES=false  # Sanitize IP addresses (disabled by default for debugging)
# Custom sanitization patterns (optional)
# Format: pattern|replacement|description;pattern2|replacement2|description2
# Example: CUSTOM_SANITIZATION_PATTERNS="INTERNAL_TOKEN_\d{10}|[INTERNAL_TOKEN]|Internal token"
CUSTOM_SANITIZATION_PATTERNS=

# Event Sanitization
# Enable secret masking in event payloads before publishing to Redpanda
# Prevents API keys, tokens, passwords from leaking into event logs
ENABLE_EVENT_SANITIZATION=true

# ==============================================================================
# Monitoring & Metrics
# ==============================================================================

# Prometheus Metrics
ENABLE_PROMETHEUS_METRICS=true  # Enable Prometheus metrics endpoint at /metrics

# ==============================================================================
# Logging
# ==============================================================================

# Log level (DEBUG, INFO, WARNING, ERROR, CRITICAL)
LOG_LEVEL=INFO

# ==============================================================================
# Notes
# ==============================================================================
#
# Security:
# - Never commit this file with real credentials
# - Use separate .env for production, staging, and development
# - Rotate SERVICE_AUTH_TOKEN regularly
