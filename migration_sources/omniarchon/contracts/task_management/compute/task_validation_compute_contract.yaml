# ONEX Task Validation Compute Contract
# Pure logic processing for task input validation and business rule enforcement

name: "TaskValidationCompute"
version: "1.0.0"
description: "Pure compute node for task validation, business rule enforcement, and data integrity checks"
node_type: "compute"

# Contract metadata
metadata:
  author: "ONEX Task Management System"
  created_date: "2025-09-04"
  tags: ["task", "validation", "compute", "business-rules"]
  complexity: "medium"

# Input schema definition
inputs:
  task_data:
    type: "object"
    required: true
    description: "Task data to be validated"
    properties:
      title:
        type: "string"
        required: true
        max_length: 200
        min_length: 1
        description: "Task title"
      description:
        type: "string"
        required: false
        max_length: 10000
        description: "Task description"
      status:
        type: "string"
        required: true
        enum: ["todo", "doing", "review", "done"]
        description: "Task status"
      assignee:
        type: "string"
        required: true
        min_length: 1
        max_length: 100
        description: "Task assignee"
      task_order:
        type: "integer"
        required: false
        minimum: 0
        maximum: 100
        default: 0
        description: "Task priority order"
      feature:
        type: "string"
        required: false
        max_length: 50
        description: "Feature grouping"
      project_id:
        type: "string"
        required: true
        format: "uuid"
        description: "Associated project ID"
      due_date:
        type: "string"
        required: false
        format: "date-time"
        description: "Task due date"
      sources:
        type: "array"
        required: false
        items:
          type: "object"
          properties:
            url:
              type: "string"
              required: true
            type:
              type: "string"
              enum: ["documentation", "api_spec", "internal_docs", "external_link"]
              required: true
            relevance:
              type: "string"
              required: true
        description: "Source references"
      code_examples:
        type: "array"
        required: false
        items:
          type: "object"
          properties:
            file:
              type: "string"
              required: true
            function:
              type: "string"
              required: true
            purpose:
              type: "string"
              required: true
        description: "Code examples"

  validation_context:
    type: "object"
    required: false
    description: "Additional validation context"
    properties:
      user_role:
        type: "string"
        description: "Current user role for authorization"
      project_settings:
        type: "object"
        description: "Project-specific validation settings"
      strict_mode:
        type: "boolean"
        default: false
        description: "Enable strict validation mode"

# Output schema definition
outputs:
  validation_result:
    type: "object"
    required: true
    description: "Validation result with details"
    properties:
      is_valid:
        type: "boolean"
        required: true
        description: "Overall validation status"
      validated_data:
        type: "object"
        required: true
        description: "Cleaned and validated task data"
      errors:
        type: "array"
        required: true
        items:
          type: "object"
          properties:
            field:
              type: "string"
              required: true
            message:
              type: "string"
              required: true
            error_code:
              type: "string"
              required: true
        description: "List of validation errors"
      warnings:
        type: "array"
        required: true
        items:
          type: "object"
          properties:
            field:
              type: "string"
              required: true
            message:
              type: "string"
              required: true
        description: "List of validation warnings"
      applied_transformations:
        type: "array"
        required: true
        items:
          type: "string"
        description: "List of data transformations applied"

# Business logic specification
compute_specification:
  algorithm: "task_validation"
  description: "Validates task data against business rules and schema constraints"

  validation_rules:
    - name: "title_validation"
      description: "Validate task title requirements"
      rules:
        - "Title must be non-empty"
        - "Title must not exceed 200 characters"
        - "Title must not contain only whitespace"
        - "Title should not contain special HTML/script characters"

    - name: "status_transition_validation"
      description: "Validate status transition rules"
      rules:
        - "New tasks must start with 'todo' status"
        - "Status transitions must follow allowed flow"
        - "Cannot move from 'done' to earlier status without approval"

    - name: "assignee_validation"
      description: "Validate assignee requirements"
      rules:
        - "Assignee must be non-empty string"
        - "Assignee must be valid user or agent identifier"
        - "Special assignees (AI agents) must be in allowed list"

    - name: "priority_validation"
      description: "Validate task priority order"
      rules:
        - "Task order must be between 0 and 100"
        - "Higher numbers indicate higher priority"

    - name: "reference_validation"
      description: "Validate source references and code examples"
      rules:
        - "URLs must be valid format"
        - "Source types must be from allowed enum"
        - "Code examples must have valid file paths"

  performance_constraints:
    max_execution_time_ms: 100
    max_memory_usage_mb: 50
    cpu_intensive: false

# Error handling specification
error_handling:
  error_types:
    - name: "VALIDATION_ERROR"
      description: "Input validation failed"
      recovery_action: "return_validation_errors"
    - name: "BUSINESS_RULE_VIOLATION"
      description: "Business rule validation failed"
      recovery_action: "return_business_rule_errors"
    - name: "DATA_TRANSFORMATION_ERROR"
      description: "Data transformation failed"
      recovery_action: "return_original_data_with_warning"

  exception_chaining: true
  context_preservation: true

# Dependencies (none for pure compute)
dependencies: []

# Testing specification
testing:
  unit_tests:
    - name: "test_valid_task_data"
      description: "Test validation with valid task data"
    - name: "test_invalid_title"
      description: "Test validation with invalid titles"
    - name: "test_invalid_status"
      description: "Test validation with invalid status values"
    - name: "test_assignee_validation"
      description: "Test assignee validation rules"
    - name: "test_business_rule_enforcement"
      description: "Test business rule validation"

  performance_tests:
    - name: "test_validation_performance"
      description: "Ensure validation completes within time constraints"
      max_duration_ms: 100

# Contract compliance
onex_compliance:
  strong_typing: true
  no_any_types: true
  pydantic_models: true
  error_chaining: true
  registry_injection: true
