# Prometheus Configuration for Archon Health Monitoring
# Place this file at: deployment/prometheus/prometheus.yml

global:
  scrape_interval: 15s
  evaluation_interval: 15s
  scrape_timeout: 10s
  external_labels:
    cluster: 'archon-production'
    environment: 'production'

# Alertmanager configuration (optional)
alerting:
  alertmanagers:
    - static_configs:
        - targets:
            # - alertmanager:9093

# Load rules once and periodically evaluate them
rule_files:
  # - "rules/*.yml"

# Scrape configurations
scrape_configs:
  # Archon Server - Main API + WebSocket
  - job_name: 'archon-server'
    scrape_interval: 15s
    scrape_timeout: 10s
    metrics_path: '/metrics'
    static_configs:
      - targets: ['archon-server:8181']
        labels:
          service: 'archon-server'
          component: 'api'

  # Archon Intelligence Service
  - job_name: 'archon-intelligence'
    scrape_interval: 15s
    scrape_timeout: 10s
    metrics_path: '/metrics'
    static_configs:
      - targets: ['archon-intelligence:8053']
        labels:
          service: 'archon-intelligence'
          component: 'intelligence'

  # Archon Bridge Service
  - job_name: 'archon-bridge'
    scrape_interval: 15s
    scrape_timeout: 10s
    metrics_path: '/metrics'
    static_configs:
      - targets: ['archon-bridge:8054']
        labels:
          service: 'archon-bridge'
          component: 'bridge'

  # Archon Search Service
  - job_name: 'archon-search'
    scrape_interval: 15s
    scrape_timeout: 10s
    metrics_path: '/metrics'
    static_configs:
      - targets: ['archon-search:8055']
        labels:
          service: 'archon-search'
          component: 'search'

  # Archon LangExtract Service
  - job_name: 'archon-langextract'
    scrape_interval: 15s
    scrape_timeout: 10s
    metrics_path: '/metrics'
    static_configs:
      - targets: ['archon-langextract:8156']
        labels:
          service: 'archon-langextract'
          component: 'extraction'

  # Archon Agents Service
  - job_name: 'archon-agents'
    scrape_interval: 15s
    scrape_timeout: 10s
    metrics_path: '/metrics'
    static_configs:
      - targets: ['archon-agents:8052']
        labels:
          service: 'archon-agents'
          component: 'agents'

  # Prometheus self-monitoring
  - job_name: 'prometheus'
    scrape_interval: 30s
    static_configs:
      - targets: ['localhost:9090']
        labels:
          service: 'prometheus'
          component: 'monitoring'

  # Qdrant Vector Database (optional)
  - job_name: 'qdrant'
    scrape_interval: 30s
    metrics_path: '/metrics'
    static_configs:
      - targets: ['qdrant:6333']
        labels:
          service: 'qdrant'
          component: 'vector-db'

  # Valkey/Redis Cache (optional, if metrics exposed)
  - job_name: 'valkey'
    scrape_interval: 30s
    static_configs:
      - targets: ['archon-valkey:6379']
        labels:
          service: 'valkey'
          component: 'cache'

# Storage configuration
storage:
  tsdb:
    path: /prometheus
    retention:
      time: 30d
      size: 10GB

# Remote write configuration (optional - for long-term storage)
# remote_write:
#   - url: "http://cortex:9009/api/prom/push"
#     queue_config:
#       capacity: 10000
#       max_shards: 200
#       min_shards: 1
#       max_samples_per_send: 5000
#       batch_send_deadline: 5s
#       min_backoff: 30ms
#       max_backoff: 100ms
