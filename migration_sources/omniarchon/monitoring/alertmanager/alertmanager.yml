# Alertmanager Configuration for Archon
# Configure via environment variables - NO credentials in this file

global:
  # SMTP config - set these environment variables to enable email alerts:
  # SMTP_SMARTHOST, SMTP_FROM, SMTP_AUTH_USERNAME, SMTP_AUTH_PASSWORD
  resolve_timeout: 5m

# Alert routing
route:
  group_by: ['alertname', 'cluster', 'service']
  group_wait: 30s
  group_interval: 5m
  repeat_interval: 4h
  receiver: 'default'

  routes:
    # Critical alerts
    - match:
        severity: critical
      receiver: 'critical-alerts'
      group_wait: 10s
      repeat_interval: 30m
      continue: true

    # System alerts
    - match:
        component: system
      receiver: 'system-alerts'

    # Database/cache alerts
    - match_re:
        component: ^(database|cache)$
      receiver: 'database-alerts'

    # Performance alerts
    - match:
        component: performance
      receiver: 'performance-alerts'

    # Infrastructure alerts
    - match:
        component: container
      receiver: 'infrastructure-alerts'

    # AI/Intelligence alerts
    - match_re:
        component: ^(rag|intelligence)$
      receiver: 'ai-alerts'

# Alert inhibition rules
inhibit_rules:
  - source_match:
      alertname: 'ArchonServiceDown'
    target_match_re:
      alertname: '^(ArchonHighResponseTime|ArchonHighErrorRate).*'
    equal: ['service']

# Receivers
receivers:
  - name: 'default'
    # Configure via env vars if needed

  - name: 'critical-alerts'
    # Slack: Uncomment and add your webhook URL when ready
    # slack_configs:
    #   - api_url: 'YOUR_SLACK_WEBHOOK_URL'
    #     channel: '#alerts-critical'
    #     send_resolved: true

  - name: 'system-alerts'
    # Slack: Uncomment and add your webhook URL when ready
    # slack_configs:
    #   - api_url: 'YOUR_SLACK_WEBHOOK_URL'
    #     channel: '#alerts-system'

  - name: 'database-alerts'
    # Slack: Uncomment and add your webhook URL when ready
    # slack_configs:
    #   - api_url: 'YOUR_SLACK_WEBHOOK_URL'
    #     channel: '#alerts-database'

  - name: 'performance-alerts'
    # Slack: Uncomment and add your webhook URL when ready
    # slack_configs:
    #   - api_url: 'YOUR_SLACK_WEBHOOK_URL'
    #     channel: '#alerts-performance'

  - name: 'infrastructure-alerts'
    # Slack: Uncomment and add your webhook URL when ready
    # slack_configs:
    #   - api_url: 'YOUR_SLACK_WEBHOOK_URL'
    #     channel: '#alerts-infrastructure'

  - name: 'ai-alerts'
    # Slack: Uncomment and add your webhook URL when ready
    # slack_configs:
    #   - api_url: 'YOUR_SLACK_WEBHOOK_URL'
    #     channel: '#alerts-ai'
