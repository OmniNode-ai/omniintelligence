---
# I/O Audit Whitelist Configuration
#
# This file defines exceptions to the I/O audit rules for ONEX nodes.
# All exceptions must have a documented reason.
#
# ============================================================================
# IMPORTANT: Inline Pragma Requirement
# ============================================================================
# Inline pragmas (# io-audit: ignore-next-line <rule>) ONLY work for files
# that are listed in this YAML whitelist. This is BY DESIGN.
#
# If you add a pragma to a file NOT listed here, it will be SILENTLY IGNORED.
#
# Correct workflow:
#   1. Add the file to this YAML whitelist with allowed_rules
#   2. Then use inline pragmas in that file for line-level granularity
#
# This ensures all I/O exceptions are centrally tracked and code-reviewed.
# ============================================================================
#
# Rule IDs:
#   - net-client: Network/DB/external client imports
#   - env-access: Environment variable access
#   - file-io: File system operations
#
# Format:
#   files:
#     - path: "relative/path/to/file.py"  # or glob pattern
#       reason: "Why this exception is needed"
#       allowed_rules:
#         - "rule-id"
#
# Example with inline pragma usage:
#   1. Add entry here:
#      - path: "src/omniintelligence/nodes/my_effect_node.py"
#        reason: "Effect node requires Kafka"
#        allowed_rules:
#          - "net-client"
#
#   2. In my_effect_node.py, use pragma for specific lines:
#      # io-audit: ignore-next-line net-client
#      from confluent_kafka import Producer

schema_version: "1.0.0"

files:
  # Test fixtures are whitelisted for testing purposes
  # Note: Inline pragmas work in this file because it's listed here
  - path: "tests/audit/fixtures/io/whitelisted_node.py"
    reason: "Test fixture for whitelist functionality"
    allowed_rules:
      - "env-access"
      - "file-io"

  # Effect nodes - these legitimately need I/O for their purpose
  - path: "src/omniintelligence/nodes/intelligence_adapter/node_intelligence_adapter_effect.py"
    reason: "Effect node consuming Kafka events and routing to intelligence operations"
    allowed_rules:
      - "net-client"
      - "env-access"

  # Node entry points (__main__.py) - these are CLI runners, not pure nodes
  # They legitimately read env vars (LOG_LEVEL, HEALTH_PORT) to configure
  # the node before instantiation. This is standard entrypoint behavior.
  - path: "src/omniintelligence/nodes/*/__main__.py"
    reason: "Entry point scripts bootstrap nodes and require env var configuration"
    allowed_rules:
      - "env-access"

# Example of a legacy node pending refactor
# - path: "src/omniintelligence/nodes/legacy_*.py"
#   reason: "Legacy nodes pending refactor - tracked in OMN-XXX"
#   allowed_rules:
#     - "env-access"
